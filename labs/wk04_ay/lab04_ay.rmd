---
title: "CPP 528 - Lab 04"
author: "Alev Yildiz"
date: "11/13/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# load necessary packages ----
library( dplyr )
library( here )
library( knitr )
library( pander )
library( stargazer )
library( scales )
# set randomization seed ----
set.seed( 1234 )
# load necessary functions and objects ----
# note: all of these are R objects that will be used throughout this .rmd file
import::here("S_TYPE",
             "panel.cor",
             "panel.smooth",
             "jplot",
             "d",
             "df",
             "cbsa_stats_df",
             # notice the use of here::here() that points to the .R file
             # where all these R objects are created
            .from = here::here("labs/wk04_ay/lab_04_source_ay.R"),
             .character_only = TRUE)

```


#Descriptives

```{r}
cbsa_stats_df %>% head()
```

```{r}
df %>% head()
```

```{r}
d %>% head()
```

#Median Home Value

```{r}
hist( df$MedianHomeValue2000, breaks=200, xlim=c(0,500000), 
      col="gray20", border="white",
      axes=F, 
      xlab="MHV (median = $138k)",
      ylab="",
      main="Median Home Value in 2000 (2010 US dollars)" )
axis( side=1, at=seq(0,500000,100000), 
      labels=c("$0","$100k","$200k","$300k","$400k","$500k") )
abline( v=median( df$MedianHomeValue2000, na.rm=T ), col="orange", lwd=3 )
```



```{r}
stargazer( df, 
           type=S_TYPE, 
           digits=0, 
           summary.stat = c("min", "p25","median","mean","p75","max") )
```


```{r}
# Omit cases that have a median home value less than $10,000 in 2000 and with growth rates above 200%

d_clean <- 
  d %>%
  filter(mhv.00 > 10000) %>%
  filter(mhv.growth < 200)

head(d_clean) %>% pander()

  
```

# Part 2 - Predict MHV Change

```{r}
colnames(d)
```

##Percent white (p.white) - I am expecting home values to increase related to the proportion of white households in the tracts in 2000.

##Percent college graduates- I am expecting that larger number of individuals with higher education (college degree) will predict larger increases in home values.

##Percent of properties vacant in 2000 (p.vacant) - I am expecting that vacancy rates are proxy measures for neighborhood neglect and thus higher vacancy rates will predict lower increases in home values.


```{r}
hist(d$p.white)
```

```{r}
hist(d$p.col)
```

```{r}
hist(d$vac)

```

```{r}
d$p.vacant.log <- log( d$p.vacant + 1 )
hist( d$p.vacant.log )

```

```{r scatter plot 1}
my_df <- select( d, mhv.growth, p.white, p.col, p.vacant, p.prof, p.unemp )

# reduce data density for visualization
set.seed( 1234 )
my_df2 <- sample_n( my_df, 10000 ) %>% na.omit()

pairs( my_df2, upper.panel=panel.cor, lower.panel=panel.smooth )
```


```{r}
# Log transformation to get rid of variable skew

# reduce data density for visualization

my_df$p.vacant <- log10( d$p.vacant + 1 )
my_df$p.col <- log10( d$p.col + 1 )
my_df$p.white <- log10( d$p.white + 1 )
my_df$p.prof <- log10( d$p.prof + 1 )
my_df$p.unemp <- log10( d$p.unemp + 1 )


my_df2 <- sample_n(my_df, 5000) %>% na.omit()


pairs( my_df2, upper.panel=panel.cor, lower.panel=panel.smooth )


```

```{r}

# Check for multicollinearity

m1 <- lm( mhv.growth ~ p.white, data = my_df)
m2 <- lm( mhv.growth ~ p.col, data = my_df)
m3 <- lm( mhv.growth ~ p.prof, data = my_df)
m4 <- lm( mhv.growth ~ p.vacant, data = my_df)
m5 <- lm( mhv.growth ~ p.unemp, data = my_df)


stargazer( m1, m2, m3, m4, m5,
           type= S_TYPE, 
           omit.stat=c("rsq","f", "ser") )
```

```{r}
# Metro-level control

d_metro <- 
  d_clean %>%
  group_by(cbsaname) %>%
  mutate( metro.mhv.growth= 100 * median( mhv.growth, na.rm = T )) %>%
  ungroup()

# Variables for regression model

d.reg <- select(d_metro, mhv.growth, p.white, p.col, p.vacant)

# Log transfromations
d.reg$p.white <- log10(d.reg$p.white + 1)
d.reg$p.col <- log10(d.reg$p.col + 1)
d.reg$p.vacant <- log10(d.reg$p.vacant + 1)  

# Regression 
m1 <- lm( mhv.growth ~ p.white, data = d.reg)
m2 <- lm( mhv.growth ~ p.col, data = d.reg)
m3 <- lm( mhv.growth ~ p.vacant, data = d.reg)
m4 <- lm( mhv.growth ~ p.white + p.col + p.vacant, data = d.reg)

stargazer( m1, m2, m3, m4, m5,
           type= S_TYPE, 
           omit.stat=c("rsq","f", "ser") )
```


# The relationship between the number of college graduates has the expected positive effect on an increase in home values. This relationship shows that the higher the education level in the area, higher the expected wages are which then raises the house prices. 

# The proportion of whites had the opposite relationship than I expected. The data predicts lower increases in home growth rates from 200 to 2010.
