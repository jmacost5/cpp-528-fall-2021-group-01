---
title: "Lab-05-PECK"
author: "April Peck"
date: "11/14/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

```{r, message=FALSE, warning=FALSE}

library(pander)
library(stargazer)
library(here)
library(dplyr)
library(tidycensus)
library(magrittr)

import::here("%>%",
             "s.type",
             "d3",
             "l3",
             # notice the use of here::here() that points to the .R file
             # where all these R objects are created
             .from = here::here("analysis/utilities_master.R"),
             .character_only = TRUE)

```
# Overview of Programs

#### About the New Market Tax Credits Program

The NMTC Program enables economically distressed communities to leverage private investment capital by providing investors with a federal tax credit. All NMTC investments must meet statutory qualifications for their investors to be able to claim the tax credit. The vast majority of NMTC investments are made within statutorily defined “Low-Income Communities.” Low-Income Communities are census tracts with a poverty rate of 20 percent or greater, or a median family income at or below 80 percent of the applicable area median family income. In addition to investments located in Low-Income Communities, investments can qualify for NMTCs by using other statutory provisions designed to target certain areas or populations, including provisions for Rural Counties, and Low-Income Targeted Populations.

Through the first 15 application rounds of the NMTC Program, the CDFI Fund has made 1,178 awards, allocating a total of $57.5 billion in tax credit authority to CDEs through a competitive application process.

[Data download website](https://github.com/DS4PS/cpp-528-spr-2020/blob/master/labs/data/raw/NMTC/nmtc-sheet-01.csv)  

[Source](https://watts-college.github.io/cpp-528-fall-2021/labs/lab-05-tutorial.html)  

[Additional Information](https://www.cdfifund.gov/programs-training/programs/new-markets-tax-credit)  


#### About the Low Income Housing Tax Credits Program

The Low-Income Housing Tax Credit (LIHTC) is the most important resource for creating affordable housing in the United States today. The LIHTC database, created by HUD and available to the public since 1997, contains information on 47,511 projects and 3.13 million housing units placed in service between 1987 and 2017. 

According to the [National Housing Law Project](https://www.nhlp.org/resources/how-the-lihtc-program-works/), the program provides tax credits to developers based on an application process and goals laid out in the qualified action plan. Developers agree to rent the units at below-market rates.

[Data download website](https://github.com/DS4PS/cpp-528-spr-2020/blob/master/labs/data/raw/LIHTC/LIHTCPUB.csv)  

[Source](https://watts-college.github.io/cpp-528-fall-2021/labs/lab-05-tutorial.html)  

[Additional Information](https://www.nhlp.org/resource-center/low-income-housing-tax-credits/)  


# Estimate impact of each program
Use the difference-in-difference framework introduced in the tutorial to estimate the impact of each federal program: the NMTC and the LIHTC.

Use your baseline model predicting tract change from Lab 04 as the starting point.
Create a log-linear diff-in-diff model following these steps and add your control variables from Lab 04

NMTC data was added to the dataset using the following code found in the data manifest:

```{r}

### NMTC

# log the variables
#y1 <- log( d$mhv.00 )
#y2 <- log( d$mhv.10 )
#lp.vac.00 <- log10( d$p.vacant.00 + 1)
#lp.vac.10 <- log10( d$p.vacant.10 + 1)
#lp.hs.00 <- log10( d$p.hs.00 + 1)
#p.hs.12 <- log10( d$p.hs.12 + 1)
#lp.unemp.00 <- log10( d$p.unemp.00 + 1)
#lp.unemp.12 <- log10( d$p.unemp.12 + 1)

# create a variable that identifies if a tract received NMTC funding
#nmtc.treat <- as.numeric( d$num.nmtc > 0 )

# store the year 2000 data
#d1 <- data.frame( y=y1, treat=nmtc.treat, post=0 )
# store the year 2010 data
#d2 <- data.frame( y=y2, treat=nmtc.treat, post=1 )

# stack the two time periods together
#d3 <- rbind( d1, d2 )

# controls ---

#p.vac
#d0 <- data.frame( lp.vac.00 = lp.vac.00, lp.vac.10 = lp.vac.10)

#d0 <- d0 %>% tidyr::gather(key = "variable_name",
#value = "p.vac")

# diff-in-diff data
#d3$p.vac <- d0$p.vac


#p.hs
#d0 <- data.frame( lp.hs.00 = lp.hs.00, lp.hs.12 = lp.hs.12)
#d0 <- d0 %>% tidyr::gather(key = "variable-name", value = "p.hs")

# diff-in-diff data
#d3$p.hs <- d0$p.hs


#p.unemp
#d0 <- data.frame( lp.unemp.00 = lp.unemp.00, lp.unemp.12 = lp.unemp.12)
#d0 <- d0 %>% tidyr::gather(key = "variable-name", value = "p.unemp")

# diff-in-diff data
#d3$p.unemp <- d0$p.unemp

#d3 <- d3 %>% na.omit(use = "everything")


```


LIHTC data was added to the dataset with the following code found in the data manifest:
```{r}

### LIHTC


# variables are already logged
#y1 <- log( d$mhv.00 )
#y2 <- log( d$mhv.10 )
#lp.vac.00 <- log10( d$p.vacant.00)
#lp.vac.10 <- log10( d$p.vacant.10)
#lp.hs.00 <- log10( d$p.hs.00)
#lp.hs.12 <- log10( d$p.hs.12)
#lp.unemp.00 <- log10( d$p.unemp.00)
#lp.unemp.12 <- log10( d$p.unemp.12)

# create a variable that identifies if a tract received LIHTC funding
#lihtc.treat <- as.numeric( d$num.lihtc > 0 )

# store the year 2000 data
#l1 <- data.frame( y=y1, treat=lihtc.treat, post=0 )
# store the year 2010 data
#l2 <- data.frame( y=y2, treat=lihtc.treat, post=1 )

# stack the two time periods together
#l3 <- rbind( l1, l2 )

# controls ---

#p.vac
#l0 <- data.frame( lp.vac.00 = lp.vac.00, lp.vac.10 = lp.vac.10)

#l0 <- l0 %>% tidyr::gather(key = "variable_name",
#value = "p.vac")

# diff-in-diff data
#l3$p.vac <- l0$p.vac


#p.hs
#l0 <- data.frame( lp.hs.00 = lp.hs.00, lp.hs.12 = lp.hs.12)

#l0 <- l0 %>% tidyr::gather(key = "variable_name",
#value = "p.hs")

# diff-in-diff data
#l3$p.hs <- l0$p.hs


#p.unemp
#l0 <- data.frame( lp.unemp.00 = lp.unemp.00, lp.unemp.12 = lp.unemp.12)

#l0 <- l0 %>% tidyr::gather(key = "variable_name",
#value = "p.unemp")

# diff-in-diff data
#l3$p.unemp <- l0$p.unemp

#l3 <- l3 %>% na.omit(use = "everything")

```

# Report & Interpret
Report and interpret the main results from the models. Are the programs effective at catalyzing neighborhood improvement? We are assuming median home value captures the increased market demand that reflects the desirability of improvements.

### NMTC
```{r, results = 'asis', warning=FALSE}

# create the difference in difference model
# note: treat = B1, post = B2, treat*post = B3
m <- lm( y ~ treat + post + p.vac + p.hs + p.unemp + treat*post, data=d3, na.rm = TRUE )

# display model results
stargazer::stargazer(m,
                     type = s.type,
                     digits = 2)
```

Houses, on average, had a 51% increase during the treatment period (2000 - 2010). Although the post-treatment coefficient is different than 1, it is not statistically significant, indicating the NMTC program is not effective.


### LIHTC
```{r, results = 'asis', warning=FALSE}

# create the difference in difference model
# note: treat = B1, post = B2, treat*post = B3
m <- lm( y ~ treat + post + p.vac + p.hs + p.unemp + treat*post, data=l3 )

# display model results
stargazer::stargazer(m,
                     type = s.type,
                     digits = 2)
```

With the LIHTC program, the post-treatment coefficient is statistically significant, but housing values rose, on average, by .03% less than houses in the control group.
