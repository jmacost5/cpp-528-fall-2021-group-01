---
title: "CPP-528-Lab05"
author: "Alev Yildiz"
date: "11/17/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(here)
library(import)
library(tidyverse)
library(pander)
library(dplyr)
library(knitr)
library(stargazer)
library(scales)
```

```{r}
# load necessary functions and objects ----
# note: all of these are R objects that will be used throughout this .rmd file
import::here("S_TYPE",
             "d",
             "df",
             "d3",
             "d6",
             "PLOTS",
             "%>%",
             # notice the use of here::here() that points to the .R file
             # where all these R objects are created
             .from = here::here("labs/wk05_ay/lab_05_source_ay.R"),
             .character_only = TRUE)

detach("package:import", unload = TRUE)
```

```{r}
d %>% head()
```

```{r}
# Save data set to rodeo folder
saveRDS(d, here("data/rodeo/rodeo-data-ay.rds"))
```

```{r}
# Load data set
readRDS(file = here("data/rodeo/rodeo-data-ay.rds"))
```
```{r}
ltdb.raw.2000s <- read.csv(here("data/raw/ltdb_std_2000_sample.csv"))
ltdb.raw.2000f <- read.csv(here("data/raw/ltdb_std_2000_fullcount.csv"))
ltdb.rodeo.2000 <- readRDS(here("data/rodeo/ltdb-2000.rds"))

ltdb.raw.2010s <- read.csv(here("data/raw/ltdb_std_2010_sample.csv"))
ltdb.raw.2010f <- read.csv(here("data/raw/ltdb_std_2010_fullcount.csv"))
ltdb.rodeo.2010 <- readRDS(here("data/rodeo/ltdb-2010.rds"))

complete.rodeo <- readRDS(file = here("data/rodeo/rodeo-data-ay.rds"))

```

#Both of the raw data sets have the same amount of row counts which indicates that there weren't any changes that required us to filter out data between these data sets. 

```{r}
nrow(ltdb.raw.2000s)
```
```{r}
nrow(ltdb.raw.2000f)
```

#Our row number changes in our 2010 data sets because there are some slight difference between these data sets. For instance, state is listed as a number in our raw sample data set, where is this listed as a qualitative variables withing the full data set. As noted by the number of rows there are more tracks in the full data set then the sample data set. 

```{r}
nrow(ltdb.raw.2010s)
```
```{r}
nrow(ltdb.raw.2010f)
```
# There are some data sets within each of these data sets that are not included in the other, and once they were merged few additional data was included. 

```{r}
nrow(ltdb.rodeo.2010)
```

# Since we filtered out rural tracks; removed the tracks that had data sets with homes that were less than ten thousand dollars; and median home value growth that was greater than 200 percent; our row numbers for the complete.rodeo data set have reduced to 59066.
```{r}
nrow(complete.rodeo)
```
```{r}
S_TYPE <- "text"
```

```{r}
d3 %>% head()
```

```{r}
m <- lm( y ~ treat + post + treat*post, data = d3)

# Y is mhv.00 and mhv.10
# Treat is an indicator of whether the tract received any NMTC funding (1 = yes, 0 = no)
# Post indicates whether y is a pre(2000) or post (2010) value
# Treat*post indicates growth amount for tracts that received funding

# display model results
stargazer::stargazer (m,
                      type= S_TYPE,
                      digits = 2)
```

# Post variables indicates that there was a growth 23 percent growth overall from 2000 for all of the tracks regardless of whether or not they participated in the mmtc program. Those tracks that were participants within the nmtc program had an additional 10 growth beyond what we would have naturally expected for home values to grow from 2000 to 2010. 


###  Program Participation Criteria


####  DATA TO BE USED FOR THE DIFF-DIFF MODEL 

```{r}
#Data for LIHTC Program

head(d6) %>% pander()
```

#### Recipient and Non-Recipient Tracts:

#### Descriptive statistics determine if we have an apples to oranges type of comparison:

```{r}
### POVERTY RATES
gridExtra::grid.arrange( PLOTS$pov_rate_2000$nmtc, 
                         PLOTS$pov_rate_2000$lihtc,
                         nrow = 1 )
```



```{r}
### HOME VALUES
gridExtra::grid.arrange( PLOTS$mhv_2000$nmtc, 
                         PLOTS$mhv_2000$lihtc, 
                         nrow = 1 )
```


##### Recipient tracts compared to non-recipient tracts are quiet different from each other. The degree depends on the program, NMTC seem to be very distinctive, and LIHTC still different but not as pronounced.

### Here are some more summary statistics comparing the two:

**Household Income 2000 Variable:**

#### LIHTC Program

```{r}

# Tracts that received LIHTC
mean( d$hinc00[ d$num.lihtc > 0 ] )
```

```{r}
# Tracts that did not 
mean( d$hinc00[ d$num.lihtc == 0 ] )
```

#### NMTC Program

```{r}
# Tracts that received NMTC
mean( d$hinc00[ d$num.nmtc > 0 ] )
```


**Home Value 2000 Variable:**

#### LIHTC Program

```{r}
### MEDIAN HOME VALUE COMPARISON IN 2000
# Tracts that received LIHTC
mean( d$mhv.00[ d$num.lihtc > 0 ], na.rm=T )
```


```{r}
# Tracts that did not
mean( d$mhv.00[ d$num.lihtc == 0 ], na.rm=T )
```

#### NMTC Program

```{r}
# Tracts that received NMTC
mean( d$mhv.00[ d$num.nmtc > 0 ], na.rm=T )
```


```{r}
# Tracts that did not
mean( d$mhv.00[ d$num.nmtc == 0 ], na.rm=T )
```

**Poverty Rates 2000 Variable:**

#### LIHTC Program

```{r}
### POVERTY RATE COMPARISONS
# Tracts that received LIHTC
summary( d$pov.rate.00[ d$num.lihtc > 0 ] )
```

```{r}
### POVERTY RATE COMPARISONS
# Tracts that did not received LIHTC
summary( d$pov.rate.00[ d$num.lihtc == 0 ] )
```

#### NMTC Program

```{r}
### POVERTY RATE COMPARISONS
# Tracts that received NMTC
summary( d$pov.rate.00[ d$num.nmtc > 0 ] )
```

```{r}
### POVERTY RATE COMPARISONS
# Tracts that did not received NMTC
summary( d$pov.rate.00[ d$num.nmtc == 0 ] )
```

**DV of MHV growth rates Variable:**

### And examining the DV of MHV growth rates to get a sense of the distribution of the outcome prior to running regression models:

```{r}
### MHV Growth Rates (DV in Model)
gridExtra::grid.arrange( PLOTS$mhv_growth$lihtc, 
                         PLOTS$mhv_growth$nmtc, 
                         nrow = 1 )
```

**LIHTC on the left is a bit misleading since there is greater density for program participant tracts in the right tail (evidence of higher treatment growth), but there is also some more density for non-participant tracts in the peak left of the distribution. It's difficult to judge visually.**

**NMTC, on the other hand, appears to be in better shape because to the high density in the right side.**

**We can confirm these with some descriptive statistics of home value growth rates:**

#### LIHTC Program

```{r}
# Tracts that received LIHTC
summary( d$growth[ d$num.lihtc > 0 ] )
```

```{r}
# Tracts that did not 
summary( d$growth[ d$num.lihtc == 0 ] )
```


#### NMTC Program


```{r}
# Tracts that received NMTC
summary( d$growth[ d$num.nmtc > 0 ] )
```


```{r}
# Tracts that did not 
summary( d$growth[ d$num.nmtc == 0 ] )
```

**Home value growth rates for LIHTC program participant and non-participant tracts are almost the same.**

**Home value growth rates for NMTC participants are significant higher than non-participant tracts. These are unconditional means with no real counterfactual, so we still need to create an evaluation framework. But they offer some suggestive evidence.**



### Evaluating Program Impact for NMTC Program


```{r}
m <- lm( y ~  treat + post +  treat*post, data=d3 )
# display model results
stargazer::stargazer(m,
                     type = S_TYPE,
                     digits = 2)
```

```{r}
# Exponentiate coefficients to recover the mean:
b0 <- m$coefficients[1] 
b1 <- m$coefficients[2]
b2 <- m$coefficients[3]
b3 <- m$coefficients[4]
# C1 = B0  
exp( b0 )
```

```{r}
# C2 = B0 + B2 
exp( b0 + b2 )
```

```{r}
# T1 = B0 + B1 
exp( b0 + b1 )
```

```{r}
# T2 = B0 + B1 + B2 + B3 
exp( b0+b1+b2+b3 )
```




### Evaluating Program Impact for LIHTC Program


```{r}
m2 <- lm( y ~  treat2 + post2 +  treat2*post2, data=d6 )
# display model results
stargazer::stargazer(m2,
                     type = S_TYPE,
                     digits = 2)
```

```{r}
# Exponentiate coefficients to recover the mean:
b0 <- m2$coefficients[1] 
b1 <- m2$coefficients[2]
b2 <- m2$coefficients[3]
b3 <- m2$coefficients[4]
# C1 = B0  
exp( b0 )
```


```{r}
# C2 = B0 + B2 
exp( b0 + b2 )
```


```{r}
# T1 = B0 + B1 
exp( b0 + b1 )
```


```{r}
# T2 = B0 + B1 + B2 + B3 
exp( b0+b1+b2+b3 )
```


**The LIHTC program doesn't have a means-test; therefore seems ineffective.**



